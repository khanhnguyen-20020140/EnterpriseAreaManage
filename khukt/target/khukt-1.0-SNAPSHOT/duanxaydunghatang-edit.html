<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Document</title>
        <script src="https://unpkg.com/htmlincludejs"></script>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" />

    </head>
    <body>
        <div class="doanhnghiep_title">
            <h4><label id="lbTitle" style="font-weight: bold;"></label></h4>
            <div class="doanhnghiep_button">
                <a class="doanhnghiep_close"  href="#"><span class="fa fa-angle-right arrowRight"></span><span class="fa fa-angle-right arrowRight"></span></a>
            </div> 
        </div>         
        <div>
            <div class="table-responsive resultsList__mobile">
                <form class="resultsList__form" id="form_register" action="">
                    <div class="form-group">
                        <label for="editDAXDHT-tda">Tên dự án:</label>
                        <input type="text" class="form-control" id="editDAXDHT-tda" placeholder="Tên dự án" name="ten">
                        <span class="resultsList__error" id="edit_tenduan_error"></span>
                    </div>
                    <div class="form-group">
                        <label for="editDAXDHT-dn">Doanh nghiệp:</label>
                        <select name="editDAXDHT-dn" id="editDAXDHT-dn" class="custom-select">
                            <option value="-1">Chọn doanh nghiệp</option>
                        </select>
                        <span class="resultsList__error" id="edit_dn_error"></span>
                    </div>
                    <div class="form-group">
                        <label for="editDAXDHT-sqdcp">Số quyết định cấp phép:</label>
                        <input type="text" class="form-control" id="editDAXDHT-sqdcp" placeholder="Số quyết định cấp phép"
                               name="editDAXDHT-sqdcp">
                        <span class="resultsList__error" id="edit_soquyetdinhchophep_null"></span>
                        <span class="resultsList__error" id="edit_soquyetdinhchophep_error"></span>
                    </div>
                    <div class="form-group">
                        <label for="editDAXDHT-vdtdk">Vốn đầu tư đăng ký:</label>
                        <input type="text" class="form-control" id="editDAXDHT-vdtdk" placeholder="Vốn đầu tư đăng ký"
                               name="editDAXDHT-vdtdk">
                        <span class="resultsList__error" id="edit_vondangkydautu_null"></span>
                        <span class="resultsList__error" id="edit_vondangkydautu_error"></span>
                    </div>
                    <div class="form-group">
                        <label for="editDAXDHT-nguonvon">Nguồn vốn:</label>
                        <select name="editDAXDHT-nguonvon" id="editDAXDHT-nguonvon" class="custom-select">
                            <option value="-1">Chọn nguồn vốn</option>
                        </select>
                        <span class="resultsList__error" id="edit_nv_error"></span>
                    </div>
                    <div class="form-group">
                        <label for="editDAXDHT-khucn">Khu công nghiệp:</label>
                        <select name="editDAXDHT-khucn" id="editDAXDHT-khucn" class="custom-select">
                            <option value="-1">Chọn khu công nghiệp</option>
                        </select>
                        <span class="resultsList__error" id="edit_kcn_error"></span>
                    </div>
                    <div class="form-group">
                        <label for="editDAXDHT-msda">Mã số dự án:</label>
                        <input type="text" class="form-control" id="editDAXDHT-msda"
                               placeholder="Mã số dự án" >
                        <span class="resultsList__error" id="edit_msda_error"></span>
                        <span class="resultsList__error" id="edit_msda_null"></span>
                    </div>
                    <div class="form-group">
                        <label for="editDAXDHT-nqdcp">Ngày quyết định cấp phép:</label>
                        <input type="date" class="form-control" id="editDAXDHT-nqdcp"
                               placeholder="Ngày quyết định cấp phép" >
                        <span class="resultsList__error" id="edit_nqdcp_error"></span>
                    </div>

                    <div class="form-group">
                        <label for="editDAXDHT-vtdusd">Vốn tương đương USD:</label>
                        <input type="text" class="form-control" id="editDAXDHT-vtdusd"
                               placeholder="Vốn tương đương USD" >
                        <span class="resultsList__error" id="edit_vtdusd_error"></span>
                    </div>
                    <div class="form-group">
                        <label for="editDAXDHT-qmcs">Quy mô/công suất:</label>
                        <input type="text" class="form-control" id="editDAXDHT-qmcs"
                               placeholder="Quy mô/công suất" >
                        <span class="resultsList__error" id="edit_qmcs_error"></span>
                    </div>
                    <div class="form-group">
                        <label for="editDAXDHT-nhphd">Ngày hết phép hoạt động:</label>
                        <input type="date" class="form-control" id="editDAXDHT-nhphd"
                               placeholder="Ngày hết phép hoạt động" >
                        <span class="resultsList__error" id="edit_nhphd_error"></span>
                    </div>
                    <div class="form-group">
                        <label for="editDAXDHT-ttda">Trạng thái dự án:</label>
                        <select name="editDAXDHT-ttda" id="editDAXDHT-ttda" class="custom-select">
                            <option value="-1">Chọn trạng thái dự án</option>
                        </select>
                        <span class="resultsList__error" id="edit_ttda_error"></span>
                    </div>
                    <div class="form-group">
                        <label for="editDAXDHT-lhda">Loại hình dự án:</label>
                        <select name="editDAXDHT-lhda" id="editDAXDHT-lhda" class="custom-select">
                            <option value="-1">Chọn loại hình dự án</option>
                        </select>
                        <span class="resultsList__error" id="edit_lhda_error"></span>
                    </div>                    
                </form>
            </div>
        </div>
        <div id="hot_edit_hangmuc_htkt">                        
        </div>
        <div class="chitiet_DAXDHT__button">
            <a href="#"><button onclick=_updateDAXDHT()><i class="fa fa-edit"></i> Cập nhật </button></a>
            <a href="#"><button onclick=_quayveDAXDHT()> Quay về </button></a>
            <a href="#"><button onclick=_drawHangmucXDHT()> Lựa chọn hạng mục </button></a>
        </div>


        <script>
            $(document).ready(function () {
                $('.doanhnghiep_close').click(function () {
                    var addfont = document.getElementById("radius");
                    $('.doanhnghiep_close').addClass('active');
                    if ($('.doanhnghiep_close').hasClass("active")) {
                        $(".mob-min").css("width", "0%");
                        $(".mob-max").css("width", "100%");
                        $(".doanhnghiep_open").css("display", "flex");
                        addfont.style.display = 'none';
                    } else {
                        $(".doanhnghiep_open").css("display", "none");
                        addfont.style.display = 'block';
                    }
                });

                $(".resultsList__mobile").submit(function (e) {
                    e.preventDefault();
                    var name = $("input[name='name']").val();
                    var email = $("input[name='email']").val();
                    $(".data-table tbody").append("<tr data-name='" + name + "' data-email='" + email + "'><td>" + name + "</td><td>" + email + "</td><td><button class='btn btn-danger btn-lg btn-delete mr-3' type='button'>Delete</button><button class='btn btn-info btn-lg btn-edit' type='button'>Edit</button></td></tr>");
                    $("input[name='']").val("");
                });
            });

            var dulieugrid_bandau = [];

            function _quayveDAXDHT() {
                cleardraw_hatangkythuat();        
                loadHtml('window_thanhphanxaydunghatang_chitiet', 'duanxaydunghatang-chitiet.html');                
            };

            function _updateDAXDHT() {
                //lấy danh sách id cho các bảng polygon, line và point
                let m_bandau_polygon = [], m_hientrang_polygon = [];
                let m_bandau_line = [], m_hientrang_line = [];
                let m_bandau_point = [], m_hientrang_point = [];
                let i, j;
                for (i = 0; i < dulieugrid_bandau.length; i++) {
                    if (dulieugrid_bandau[i].typeobject === 3)
                        m_bandau_point.push(dulieugrid_bandau[i].id); //point
                    if (dulieugrid_bandau[i].typeobject === 2)
                        m_bandau_line.push(dulieugrid_bandau[i].id); //line
                    if (dulieugrid_bandau[i].typeobject === 1)
                        m_bandau_polygon.push(dulieugrid_bandau[i].id); //polygon
                }
                for (j = 0; j < hotedithtkt.countRows(); j++) {
                    var row = hotedithtkt.getDataAtRow(j);
                    if (row[1] === 3)
                        m_hientrang_point.push(row[0]);
                    if (row[1] === 2)
                        m_hientrang_line.push(row[0]);
                    if (row[1] === 1)
                        m_hientrang_polygon.push(row[0]);
                }
                //xét bảng point
                let arrId_Xoa = [];
                let arrId_Themmoi = [];
                for (i = 0; i < m_bandau_point.length; i++) {
                    if (m_hientrang_point.indexOf(m_bandau_point[i]) == -1) {
                        arrId_Xoa.push(m_bandau_point[i]);
                    }
                }
                jQuery.ajax({
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                    },
                    type: 'PUT',
                    async: false,
                    url: "http://" + hostname + ":" + port + "/hatangkythuatpoint/hatangkythuatpoints/-1",
                    data: arrId_Xoa.join()
                }).done(function () {});
                for (i = 0; i < m_hientrang_point.length; i++) {
                    if (m_bandau_point.indexOf(m_hientrang_point[i]) == -1) {
                        arrId_Themmoi.push(m_hientrang_point[i]);
                    }
                }
                jQuery.ajax({
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                    },
                    type: 'PUT',
                    async: false,
                    url: "http://" + hostname + ":" + port + "/hatangkythuatpoint/hatangkythuatpoints/" + idDuanHTKTSelected,
                    data: arrId_Themmoi.join()
                }).done(function () {});

                //xét bảng line
                arrId_Xoa = [];
                arrId_Themmoi = [];
                for (i = 0; i < m_bandau_line.length; i++) {
                    if (m_hientrang_line.indexOf(m_bandau_line[i]) == -1) {
                        arrId_Xoa.push(m_bandau_line[i]);
                    }
                }
                jQuery.ajax({
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                    },
                    type: 'PUT',
                    async: false,
                    url: "http://" + hostname + ":" + port + "/hatangkythuatline/hatangkythuatlines/-1",
                    data: arrId_Xoa.join()
                }).done(function () {});
                for (i = 0; i < m_hientrang_line.length; i++) {
                    if (m_bandau_line.indexOf(m_hientrang_line[i]) == -1) {
                        arrId_Themmoi.push(m_hientrang_line[i]);
                    }
                }
                jQuery.ajax({
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                    },
                    type: 'PUT',
                    async: false,
                    url: "http://" + hostname + ":" + port + "/hatangkythuatline/hatangkythuatlines/" + idDuanHTKTSelected,
                    data: arrId_Themmoi.join()
                }).done(function () {});

                //xét bảng polygon
                arrId_Xoa = [];
                arrId_Themmoi = [];
                for (i = 0; i < m_bandau_polygon.length; i++) {
                    if (m_hientrang_polygon.indexOf(m_bandau_polygon[i]) == -1) {
                        arrId_Xoa.push(m_bandau_polygon[i]);
                    }
                }
                jQuery.ajax({
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                    },
                    type: 'PUT',
                    async: false,
                    url: "http://" + hostname + ":" + port + "/hatangkythuatpolygon/hatangkythuatpolygons/-1",
                    data: arrId_Xoa.join()
                }).done(function () {});
                for (i = 0; i < m_hientrang_polygon.length; i++) {
                    if (m_bandau_polygon.indexOf(m_hientrang_polygon[i]) == -1) {
                        arrId_Themmoi.push(m_hientrang_polygon[i]);
                    }
                }
                jQuery.ajax({
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                    },
                    type: 'PUT',
                    async: false,
                    url: "http://" + hostname + ":" + port + "/hatangkythuatpolygon/hatangkythuatpolygons/" + idDuanHTKTSelected,
                    data: arrId_Themmoi.join()
                }).done(function () {});

                cleardraw_hatangkythuat();
                //quay ve trang truoc
                $('#' + activedHtml).hide();
                activedHtml = 'window_thanhphanxaydunghatang_chitiet';
                reloadHtml('window_thanhphanxaydunghatang_chitiet', 'duanxaydunghatang-chitiet.html');
                $('#window_thanhphanxaydunghatang_chitiet').show();
            };

            function _drawHangmucXDHT() {
                //bước 1. Tìm mã khu chuyên ngành
                try {
                    var m_id_khuchuyennganh = -1;
                    dynamicSQL('http://' + hostname + ':' + port + '/duanXaydunghatang/duanXaydunghatang/' + idDuanHTKTSelected);
                    if (!jQuery.isEmptyObject(dataResponse)) {
                        var e = JSON.parse(JSON.stringify(dataResponse));
                        m_id_khuchuyennganh = e.idKhuChuyennganh.id;
                    }
                } catch (e) {
                    console.log(e);
                }
                //bước 2. Lấy thông tin khu chuyên ngành
                $.ajax({
                    url: "http://" + hostname + ":" + port + "/khuchuyennganh/khuchuyennganh/" + m_id_khuchuyennganh,
                    type: 'GET',
                    success: function (response) {
                        if (response.lat !== null && response.lon) {
                            map.flyTo({
                                center: [response.lon, response.lat],
                                zoom: 14,
                                essential: true
                            });
                        }
                    }
                });
                //bước 3. draw hạng mục
                taoduan_hatangkythuat = 1;
                lsHighlightQHPolygon = [];
                lsHighlightQHLine = [];
                lsHighlightQHPoint = [];
                for (var i = 0; i < hotedithtkt.countRows(); i++) {
                    var row = hotedithtkt.getDataAtRow(i);
                    //console.log('row '+i+': '+row.toString()); => 280,1,Đất xây dựng nhà máy (280)
                    if (row[1] === 1)
                        lsHighlightQHPolygon.push(row[0]);
                    else if (row[1] === 2)
                        lsHighlightQHLine.push(row[0]);
                    else if (row[1] === 3)
                        lsHighlightQHPoint.push(row[0]);
                    map.setFilter('khucn_hatangkythuat_polygon_highlighted', ['in', 'highlight', ...lsHighlightQHPolygon]);
                    map.setFilter('khucn_hatangkythuat_line_highlighted', ['in', 'highlight', ...lsHighlightQHLine]);
                    map.setFilter('khucn_hatangkythuat_circle_highlighted', ['in', 'highlight', ...lsHighlightQHPoint]);
                }
            };

            //function onload_editDAXDHT() {
            $.ajax({
                url: "http://" + hostname + ":" + port + "/duanXaydunghatang/duanXaydunghatang/" + idDuanHTKTSelected,
                type: 'GET',
                success: function (response) {
                    //console.log(response)
                    if (response.ten !== null)
                        $("#editDAXDHT-tda").val(response.ten);

                    if (response.idDoanhnghiep !== null) {
                        loadCbHtml('editDAXDHT-dn', 'http://' + hostname + ':' + port + '/doanhnghiep/doanhnghieps/', response.idDoanhnghiep.id);
                    } else {
                        loadCbHtml('editDAXDHT-dn', 'http://' + hostname + ':' + port + '/doanhnghiep/doanhnghieps/', -1);
                    }
                    if (response.soqdCapphep !== null)
                        $("#editDAXDHT-sqdcp").val(response.soqdCapphep);
                    if (response.vondautuDangky !== null)
                        $("#editDAXDHT-vdtdk").val(response.vondautuDangky);
                    if (response.idNguonvon !== null) {
                        loadCbHtml('editDAXDHT-nv', 'http://' + hostname + ':' + port + '/nguonvondautu/nguonvondautus/', response.idNguonvon.id);
                    } else {
                        loadCbHtml('editDAXDHT-nv', 'http://' + hostname + ':' + port + '/nguonvondautu/nguonvondautus/', -1);
                    }
                    if (response.idKhuChuyennganh !== null) {
                        loadCbHtml('editDAXDHT-kcn', 'http://' + hostname + ':' + port + '/khuchuyennganh/khuchuyennganhs/', response.idKhuChuyennganh.id);
                    } else {
                        loadCbHtml('editDAXDHT-kcn', 'http://' + hostname + ':' + port + '/khuchuyennganh/khuchuyennganhs/', -1);
                    }

                    if (response.masoDuan !== null)
                        $("#editDAXDHT-msda").val(response.masoDuan);

                    if (response.ngayQuyetdinhCapphep !== null)
                        $("#editDAXDHT-nqdcp").val(response.ngayQuyetdinhCapphep);
                    if (response.vontuongduongUsd !== null)
                        $("#editDAXDHT-vtdusd").val(response.vontuongduongUsd);
                    if (response.quymoCongsuat !== null)
                        $("#editDAXDHT-qmcs").val(response.quymoCongsuat);
                    if (response.ngayHetphepHoatdong !== null)
                        $("#editDAXDHT-nhphd").val(response.ngayHetphepHoatdong);

                    if (response.idTrangthaiDuan !== null) {
                        loadCbHtml('editDAXDHT-ttda', 'http://' + hostname + ':' + port + '/dmtrangthai/dmtrangthais/', response.idTrangthaiDuan.id);
                    } else {
                        loadCbHtml('editDAXDHT-ttda', 'http://' + hostname + ':' + port + '/dmtrangthai/dmtrangthais/', -1);

                    }
                    if (response.idLoaihinhDuan !== null) {
                        loadCbHtml('editDAXDHT-lhda', 'http://' + hostname + ':' + port + '/dmloaihinhduan/dmloaihinhduans/', response.idLoaihinhDuan.id);
                    } else {
                        loadCbHtml('editDAXDHT-lhda', 'http://' + hostname + ':' + port + '/dmloaihinhduan/dmloaihinhduans/', -1);
                    }
                }
            });

            try {
                dynamicSQL('http://' + hostname + ':' + port + '/duanXaydunghatang/duanXaydunghatang/' + idDuanHTKTSelected);
                var element = JSON.parse(JSON.stringify(dataResponse));
                $("#lbTitleEdit").html(element.ten);
            } catch (e) {
                console.log(e);
            }

            //console.log('maduan:'+idDuanHTKTSelected);
            //lấy danh sách hạng mục dự án
            let data_hangmuc_edit = [];
            try {
                dynamicSQL('http://' + hostname + ':' + port + '/hatangkythuatpolygon/duanhatangkythuat/' + idDuanHTKTSelected);
                if (!jQuery.isEmptyObject(dataResponse)) {
                    Object.keys(dataResponse).forEach(function (key) {
                        var element = JSON.parse(JSON.stringify(dataResponse[key]));
                        var res = {};
                        res.id = element.gid;
                        res.typeobject = 1;
                        var e = {};
                        e.id = element.gid;
                        e.typeobject = 1;
                        if (element.ten === null)
                            res.ten = "";//ten hang muc
                        else
                            res.ten = element.ten + ' (' + element.gid + ')';
                        data_hangmuc_edit.push(res);
                        dulieugrid_bandau.push(e);
                    });
                }
            } catch (e) {
                console.log(e);
            }
            try {
                dynamicSQL('http://' + hostname + ':' + port + '/hatangkythuatline/duanhatangkythuat/' + idDuanHTKTSelected);
                if (!jQuery.isEmptyObject(dataResponse)) {
                    Object.keys(dataResponse).forEach(function (key) {
                        var element = JSON.parse(JSON.stringify(dataResponse[key]));
                        var res = {};
                        res.id = element.gid;
                        res.typeobject = 2;
                        var e = {};
                        e.id = element.gid;
                        e.typeobject = 2;
                        if (element.ten === null)
                            res.ten = "";//ten hang muc
                        else
                            res.ten = element.ten + ' (' + element.gid + ')';
                        data_hangmuc_edit.push(res);
                        dulieugrid_bandau.push(e);
                    });
                }
            } catch (e) {
                console.log(e);
            }
            try {
                dynamicSQL('http://' + hostname + ':' + port + '/hatangkythuatpoint/duanhatangkythuat/' + idDuanHTKTSelected);
                if (!jQuery.isEmptyObject(dataResponse)) {
                    Object.keys(dataResponse).forEach(function (key) {
                        var element = JSON.parse(JSON.stringify(dataResponse[key]));
                        var res = {};
                        res.id = element.gid;
                        res.typeobject = 3;
                        var e = {};
                        e.id = element.gid;
                        e.typeobject = 3;
                        if (element.ten === null)
                            res.ten = "";//ten hang muc
                        else
                            res.ten = element.ten + ' (' + element.gid + ')';
                        data_hangmuc_edit.push(res);
                        dulieugrid_bandau.push(e);
                    });
                }
            } catch (e) {
                console.log(e);
            }

            //khởi tạo grid
            var hotEditElementHTKT = document.querySelector('#hot_edit_hangmuc_htkt');
            var hotEditSettingsHTKT = {
                data: data_hangmuc_edit,
                columns: [
                    {
                        data: 'id',
                        type: 'text',
                        width: 40
                    },
                    {
                        data: 'typeobject',
                        type: 'text',
                        width: 40
                    },
                    {
                        data: 'ten',
                        type: 'text'
                    }
                ],
                stretchH: 'all',
                width: $('#content').width() - 30,
                autoWrapRow: true,
                rowHeights: 40,
                height: 400,//data_hangmuc_edit.length * 41,
                manualRowResize: true,
                manualColumnResize: true,
                rowHeaders: true,
                colHeaders: [
                    'ID',
                    'Kiểu object',
                    'Hạng mục xây dựng hạ tầng kỹ thuật'
                ],
                manualRowMove: true,
                manualColumnMove: true,
                contextMenu: {
                    items: {
                        remove_row: {
                            name: 'Xóa dòng',
                            callback: function (key, options) {
                                //alert('start:'+options[0].start.row+', end:'+options[0].end.row);
                                //alert('start:'+options[0].start.col+', end:'+options[0].end.col);
                                let arrId = [];
                                for(var i=options[0].start.row;i<=options[0].end.row;i++){
                                    var row = this.getDataAtRow(i);
                                    arrId.push({'id':row[0],'typeobject':row[1]});
                                    if(row[1] === 1){//polygon
                                        const index = lsHighlightQHPolygon.indexOf(row[0]);
                                        lsHighlightQHPolygon.splice(index, 1);
                                    }else if(row[1] === 2){//line
                                        const index = lsHighlightQHLine.indexOf(row[0]);
                                        lsHighlightQHLine.splice(index, 1);
                                    }else if(row[1] === 3){//point
                                        const index = lsHighlightQHPoint.indexOf(row[0]);
                                        lsHighlightQHPoint.splice(index, 1);
                                    }
                                }
                                for (var j=0;j<arrId.length;j++){
                                    for (var i = 0; i < this.countRows(); i++) {
                                        var row = this.getDataAtRow(i);
                                        if(row[0] === arrId[j].id && row[1] === arrId[j].typeobject){
                                            this.alter('remove_row', i);
                                            break;
                                        }
                                    }
                                }
                                map.setFilter('khucn_hatangkythuat_polygon_highlighted', ['in', 'highlight', ...lsHighlightQHPolygon]);
                                map.setFilter('khucn_hatangkythuat_line_highlighted', ['in', 'highlight', ...lsHighlightQHLine]);
                                map.setFilter('khucn_hatangkythuat_circle_highlighted', ['in', 'highlight', ...lsHighlightQHPoint]);
                                /*this.updateSettings({
                                    height: this.countRows() * 41
                                });*/
                                popup.remove();
                            }
                        }
                    }
                },
                filters: true,
                dropdownMenu: false,
                hiddenColumns: {
                    columns: [0, 1],
                    indicators: true
                }
            };
            
            function showMsgPopup(id, typeobject) {
                //msgFeature(e.lngLat, features[0].properties.ten + ' ('+features[0].id+')');
                try {
                    if(typeobject === 3){
                        dynamicSQL('http://' + hostname + ':' + port + '/hatangkythuatpoint/hatangkythuatpoint/' + id);
                    }else if(typeobject === 2){
                        dynamicSQL('http://' + hostname + ':' + port + '/hatangkythuatline/hatangkythuatline/' + id);
                    }else if(typeobject === 1){
                        dynamicSQL('http://' + hostname + ':' + port + '/hatangkythuatpolygon/hatangkythuatpolygon/' + id);
                    }
                    if (!jQuery.isEmptyObject(dataResponse)) {
                        var element = JSON.parse(JSON.stringify(dataResponse));
                        var lngLat = [];
                        lngLat.push(element.longitude);        
                        lngLat.push(element.latitude);                                            
                        msgFeature(lngLat, element.ten + ' ('+element.gid+')');
                    }
                } catch (e) {
                    console.log(e);
                }
            }

            hotedithtkt = new Handsontable(hotEditElementHTKT, hotEditSettingsHTKT);
            hotedithtkt.addHook('beforeOnCellMouseDown', function (event, coords, TD, controller) {
                //console.log('row click= ' + coords.row);
                let id = hotedithtkt.getDataAtCell(coords.row, 0);
                let typeobject = hotedithtkt.getDataAtCell(coords.row, 1);
                showMsgPopup(id, typeobject);
            });
            hotedithtkt.addHook('afterDocumentKeyDown', function (event) {
                var results = hotedithtkt.getSelected();//[[startRow, startCol, endRow, endCol],..]
                console.log('row click= ' + results[0][0]);
                let id = hotedithtkt.getDataAtCell(results[0][0], 0);
                let typeobject = hotedithtkt.getDataAtCell(results[0][0], 1);
                showMsgPopup(id, typeobject);
            });
           /*hotedithtkt.addHook('beforeRemoveRow', function (index, amount, physicalRows, source) {
                
            });*/
        </script>
    </body>
</html>