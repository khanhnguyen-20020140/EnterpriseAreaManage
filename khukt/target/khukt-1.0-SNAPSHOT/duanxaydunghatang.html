<!DOCTYPE html>
<html lang="en">

<head>
    <style>
        body {
            color: black;
        }
    </style>
    <script>
        var changeinnerWidth_duanxaydunghatang;
    </script>
</head>

<body>
    <div class="filter">
        <div class="filter__around">
            <h1> Dự án xây dựng hạ tầng </h1>
            <div class="filter__click">
                <button onclick="changeinnerWidth_duanxaydunghatang()"><span
                        class="glyphicon glyphicon-resize-small"></span></button>
                <a href="#" class="handleFilter doanhnghiep_closegrid"><span
                        class="fa fa-angle-right arrowRight"></span><span
                        class="fa fa-angle-right arrowRight"></span></a>

            </div>
        </div>
        <div class="clearfix"></div>
        <form class="filterForm">
        </form>
    </div>

    <div class="alert alert-success" id="duanxaydunghatang-success-alert">
        <button type="button" class="close" data-dismiss="alert">x</button>
        <strong> <i class="fa fa-check" aria-hidden="true"></i>Bạn đã cập nhật dữ liệu thành công! </strong>
    </div>



    <div class="resultsList" id="resultsList_daxdht">
        
        <div class="row" id="row">
            <div class="mapView__table col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <div class="resultsList__button">
                    <button id="button-duanxaydunghatang" class="button-3"></button>
                    <div id="download-duanxaydunghatang"></div>
                </div>
                <div id="example">
                    <div id="hot_duanxaydunghatang"></div>
                </div>
            </div>
        </div>
    </div>



    <div class="duanxaydunghatang-report" id="duanxaydunghatang-report" width="100%" height="600px">


        <script>

            $("#duanxaydunghatang-success-alert").hide();           
            var loadedduanxaydunghatang = 0;
            
            button = document.getElementById("button-duanxaydunghatang");

            button.innerHTML = "<i class='fa-floppy-o fa fa-floppy-disk'></i>";

            var foo = [];
            var i = 0;
            var input_download = document.getElementById("download-duanxaydunghatang");

            function getbaocao_duanxaydunghatang() {

                $.ajax({
                    url: "http://" + hostname + ":" + port + "/duanXaydunghatang/pdfrender/",
                    type: 'GET',

                });

                setTimeout(() => {
                    $('#duanxaydunghatang-report').load('duanXaydunghatang-report.html');
                }
                    , 2000);

                setTimeout(() => {
                    document.getElementById("resultsList_daxdht").style.display = 'none';

                    document.getElementById("duanxaydunghatang-report").style.display = 'block';

                }
                    , 3000);


            }
            //bước 1. lấy danh sách lĩnh vực sản xuất kinh doanh
            let str_doanhnghieps = [];
            let id_doanhnghieps = [];
            try {
                dynamicSQL('http://' + hostname + ':' + port + '/doanhnghiep/doanhnghieps/');
                //console.log('objs: ' + JSON.stringify(dataResponse));
                Object.keys(dataResponse).forEach(function (key) {
                    let json = JSON.parse(JSON.stringify(dataResponse[key]));
                    str_doanhnghieps.push(json.ten);
                    id_doanhnghieps.push(json.id);
                });
            } catch (e) {
                console.log(e);
            }

            //bước 2. lấy danh sách loại doanh nghiệp
            let str_khuchuyennganhs = [];
            let id_khuchuyennganhs = [];
            try {
                dynamicSQL('http://' + hostname + ':' + port + '/khuchuyennganh/khuchuyennganhs/');
                Object.keys(dataResponse).forEach(function (key) {
                    let json = JSON.parse(JSON.stringify(dataResponse[key]));
                    str_khuchuyennganhs.push(json.ten);
                    id_khuchuyennganhs.push(json.id);
                });
            } catch (e) {
                console.log(e);
            }


            let str_nguonvondautus = [];
            let id_nguonvondautus = [];
            try {
                dynamicSQL('http://' + hostname + ':' + port + '/nguonvondautu/nguonvondautus/');
                Object.keys(dataResponse).forEach(function (key) {
                    let json = JSON.parse(JSON.stringify(dataResponse[key]));
                    str_nguonvondautus.push(json.nguonvon);
                    id_nguonvondautus.push(json.id);
                });
            } catch (e) {
                console.log(e);
            }




            let str_dmtrangthais = [];
            let id_dmtrangthais = [];
            try {
                dynamicSQL('http://' + hostname + ':' + port + '/dmtrangthai/dmtrangthais/');
                Object.keys(dataResponse).forEach(function (key) {
                    let json = JSON.parse(JSON.stringify(dataResponse[key]));
                    str_dmtrangthais.push(json.trangthai);
                    id_dmtrangthais.push(json.id);
                });
            } catch (e) {
                console.log(e);
            }

            let str_loaihinhduans = [];
            let id_loaihinhduans = [];
            try {
                dynamicSQL('http://' + hostname + ':' + port + '/dmloaihinhduan/dmloaihinhduans/');
                Object.keys(dataResponse).forEach(function (key) {
                    let json = JSON.parse(JSON.stringify(dataResponse[key]));
                    str_loaihinhduans.push(json.loaihinhDuan);
                    id_loaihinhduans.push(json.id);
                });
            } catch (e) {
                console.log(e);
            }



            
            let data_duanxaydunghatang = [];
            try {
                dynamicSQL('http://' + hostname + ':' + port + '/duanXaydunghatang/duanXaydunghatangs/');
                Object.keys(dataResponse).forEach(function (key) {
                    var element = JSON.parse(JSON.stringify(dataResponse[key]));
                    var res = {};
                    res.id = element.id;
                    if (element.ten === null)
                        res.ten = "";//ten doanh nghiep
                    else
                        res.ten = element.ten;

                    if (element.soqdCapphep === null)
                        res.soqdCapphep = "";//giam doc
                    else
                        res.soqdCapphep = element.soqdCapphep;

                    if (element.vondautuDangky === null)
                        res.vondautuDangky = "";//dia chi                    
                    else
                        res.vondautuDangky = element.vondautuDangky;

                    if (element.tongmucDautu === null)
                        res.tongmucDautu = "";//dia chi                    
                    else
                        res.tongmucDautu = element.tongmucDautu;



                    if (element.masoDuan === null)
                        res.masoDuan = "";//ma dang ky                    
                    else
                        res.masoDuan = element.masoDuan;

                    if (element.ngayQuyetdinhCapphep === null)
                        res.ngayQuyetdinhCapphep = "";//ngay dang ky  
                    else {

                        const myArray = element.ngayQuyetdinhCapphep.split("-");
                        var newDate = "";
                        newDate = newDate.concat(myArray[2]);
                        newDate = newDate.concat("/");
                        newDate = newDate.concat(myArray[1]);
                        newDate = newDate.concat("/");

                        newDate = newDate.concat(myArray[0]);


                        res.ngayQuyetdinhCapphep = newDate;
                    }


                    if (element.vontuongduongUsd === null)
                        res.vontuongduongUsd = "";//ma so thue    
                    else
                        res.vontuongduongUsd = element.vontuongduongUsd;

                    if (element.quymoCongsuat === null)
                        res.quymoCongsuat = "";//linh vuc kinh doanh
                    else
                        res.quymoCongsuat = element.quymoCongsuat;


                    if (element.ngayHetphepHoatdong === null)
                        res.ngayHetphepHoatdong = "";//linh vuc kinh doanh
                    else {
                        const myArray = element.ngayHetphepHoatdong.split("-");
                        var newDate = "";
                        newDate = newDate.concat(myArray[2]);
                        newDate = newDate.concat("/");
                        newDate = newDate.concat(myArray[1]);
                        newDate = newDate.concat("/");

                        newDate = newDate.concat(myArray[0]);


                        res.ngayHetphepHoatdong = newDate;
                    }


                    if (element.idLoaihinhDuan === null)
                        res.idLoaihinhDuan = "";//linh vuc kinh doanh
                    else
                        res.idLoaihinhDuan = element.idLoaihinhDuan.loaihinhDuan;

                    if (element.idKhuChuyennganh === null)
                        res.khuchuyennganh = "";
                    else
                        res.khuchuyennganh = element.idKhuChuyennganh.ten;


                    if (element.idDoanhnghiep === null)
                        res.tenDoanhnghiep = "";
                    else
                        res.tenDoanhnghiep = element.idDoanhnghiep.ten;


                    if (element.idNguonvon === null)
                        res.nguonvon = "";
                    else
                        res.nguonvon = element.idNguonvon.nguonvon;

                    if (element.idTrangthaiDuan === null)
                        res.trangthai = "";
                    else
                        res.trangthai = element.idTrangthaiDuan.trangthai;




                    data_duanxaydunghatang.push(res);
                });
            } catch (e) {
                console.log(e);
            }

            //khởi tạo grid
            var hotElementDN = document.querySelector('#hot_duanxaydunghatang');
            var hotSettingsDN = {
                data: data_duanxaydunghatang,
                columns: [
                    {
                        data: 'id',
                        type: 'text',
                        width: 40
                    },
                    {
                        data: 'ten',
                        type: 'text'
                    },
                    {
                        data: 'soqdCapphep',
                        type: 'text'
                    },
                    {
                        data: 'vondautuDangky',
                        type: 'text'
                    },

                    {
                        data: 'masoDuan',
                        type: 'text'
                    },
                    {
                        data: 'ngayQuyetdinhCapphep',
                        type: 'date',
                        dateFormat: 'DD/MM/YYYY'
                    },
                    {
                        data: 'vontuongduongUsd',
                        type: 'text'
                    },
                    {
                        data: 'quymoCongsuat',
                        type: 'text'
                    },
                    {
                        data: 'ngayHetphepHoatdong',
                        type: 'date',
                        dateFormat: 'DD/MM/YYYY'
                    },
                    {
                        data: 'idLoaihinhDuan',
                        type: 'dropdown',
                        source: str_loaihinhduans
                    },
                    {
                        data: 'tenDoanhnghiep',
                        type: 'dropdown',
                        source: str_doanhnghieps
                    },
                    {
                        data: 'nguonvon',
                        type: 'dropdown',
                        source: str_nguonvondautus
                    }, {
                        data: 'khuchuyennganh',
                        type: 'dropdown',
                        source: str_khuchuyennganhs
                    },
                    {
                        data: 'trangthai',
                        type: 'dropdown',
                        source: str_dmtrangthais
                    },
                    {
                        data: 'tongmucDautu',
                        type: 'text'
                    }
                ],
                stretchH: 'all',
                width: $('#content').width() - 50,
                autoWrapRow: true,
                height: $('#content').height() - 150,
                manualRowResize: true,
                manualColumnResize: true,
                rowHeaders: true,
                colHeaders: [
                    'ID',
                    'Tên dự án',
                    'Số quyết định cấp phép',
                    'Vốn đầu tư đăng ký',
                    'Mã số dự án',
                    'Ngày quyết định cấp phép',
                    'Vốn tương đương USD',
                    'Quy mô công suất',
                    'Ngày hết phép hoạt động',
                    'Loại hình dự án',
                    'Doanh nghiệp',
                    'Nguồn vốn',
                    'Khu chuyên ngành',
                    'Trạng thái dự án',
                    'Tổng mức đầu tư'
                ],

                afterGetColHeader: function (col, TH) {
                    var TR = TH.parentNode;
                    var THEAD = TR.parentNode;
                    var headerLevel = (-1) * THEAD.childNodes.length + Array.prototype.indexOf.call(THEAD.childNodes, TR);

                    function applyClass(elem, className) {
                        if (!Handsontable.dom.hasClass(elem, className)) {
                            Handsontable.dom.addClass(elem, className);
                        }
                    }

                    if (col < 0) {
                        TH.innerHTML = 'STT'
                    }


                },

                manualRowMove: true,
                manualColumnMove: true,
                contextMenu: true,
                filters: true,
                dropdownMenu: true,
                hiddenColumns: {
                    columns: [0],
                    indicators: true
                }
            };
            var hotdaxdht = new Handsontable(hotElementDN, hotSettingsDN);


            hotdaxdht.updateSettings({
                dropdownMenu: ['filter_by_value', 'filter_action_bar'],
                contextMenu: {
                    items: {
                        "row_above": {
                            name: 'Chèn thêm dòng vào phía trên',
                            disabled: function () {
                                //if first row, disable this option
                                return (hotdaxdht.getSelected() && hotdaxdht.getSelected()[0] === 0)
                            }
                        },

                        "row_below": {
                            name: 'Chèn thêm dòng vào phía dưới',
                            disabled: function () {
                                //if first row, disable this option
                                return (hotdaxdht.getSelected() && hotdaxdht.getSelected()[0] === 0)
                            }
                        },

                        "remove_row": {
                            name: 'Xóa dòng',
                            disabled: function () {
                                //if first row, disable this option
                                return (hotdaxdht.getSelected() && hotdaxdht.getSelected()[0] === 0)
                            }
                        },

                        "undo": {
                            name: 'Lùi lại một thao tác',
                            disabled: function () {
                                //if first row, disable this option
                                return (hotdaxdht.getSelected() && hotdaxdht.getSelected()[0] === 0)
                            }
                        },

                        "redo": {
                            name: 'Lặp lại một thao tác',
                            disabled: function () {
                                //if first row, disable this option
                                return (hotdaxdht.getSelected() && hotdaxdht.getSelected()[0] === 0)
                            }
                        },

                        "copy": {
                            name: 'Sao chép',
                            disabled: function () {
                                //if first row, disable this option
                                return (hotdaxdht.getSelected() && hotdaxdht.getSelected()[0] === 0)
                            }
                        },

                        "cut": {
                            name: 'Xóa',
                            disabled: function () {
                                //if first row, disable this option
                                return (hotdaxdht.getSelected() && hotdaxdht.getSelected()[0] === 0)
                            }
                        },

                    }
                }
            })




            // tat ca cac id da thay doi null bi trung
            var arrID_Change = [];
            var arrRow_Change = [];

            hotdaxdht.addHook('afterChange', (changes) => {
                changes.forEach(([row, prop, oldValue, newValue]) => {
                    var id_check = hotdaxdht.getData()[row][0];
                    if (!arrID_Change.includes(id_check) && id_check !== null) {
                        arrID_Change.push(id_check);
                        arrRow_Change.push(row);
                    }
                });
            });


            var arrID_Delete = [];

            hotdaxdht.addHook('beforeRemoveRow', (index, amount) => {
                for (var i = 0; i < amount; i++) {
                    arrID_Delete.push(hotdaxdht.getData()[index + i][0]);
                }

            });



            //            console.log(hotdaxdht.getData())

            //cập nhật dữ liệu
            button.addEventListener("click", function () {
                var dulieu = hotdaxdht.getData();

                var changed = 0;
                var checkDelete = 1;
                var checkUpdate = 1;
                var checkAdd = 1;
                //bước 1. xóa dữ liệu
                if (arrID_Delete.length > 0) {
                    //console.log('delete:' + arrID_Delete.toString());
                    for (i = 0; i < arrID_Delete.length; i++) {


                        var id_delete = arrID_Delete[i];
                        $.ajax({
                            url: "http://" + hostname + ":" + port + "/duanXaydunghatang/duanXaydunghatang/" + id_delete,
                            type: 'DELETE',
                            async: false,
                            success: function (result) {

                                var duanXaydunghatang_deleted = document.getElementById("element_DAXDHT__row__" + id_delete);

                                duanXaydunghatang_deleted.remove();

                            }
                            ,
                            error: function () {
                                checkDelete = 0;
                            }
                        });


                    }
                    arrID_Delete = [];
                }
                //bước 2. thêm dữ liệu mới
                for (i = 0; i < dulieu.length; i++) {
                    if (dulieu[i][0] === null) {


                        var obj = {};
                        if (dulieu[i][1] !== '' && dulieu[i][1] !== null)
                            obj["ten"] = dulieu[i][1];
                        if (dulieu[i][2] !== '' && dulieu[i][2] !== null)
                            obj["soqdCapphep"] = dulieu[i][2];
                        if (dulieu[i][3] !== '' && dulieu[i][3] !== null)
                            obj["vondautuDangky"] = dulieu[i][3];

                        if (dulieu[i][4] !== '' && dulieu[i][4] !== null)
                            obj["masoDuan"] = dulieu[i][4];
                        if (dulieu[i][5] !== '' && dulieu[i][5] !== null) {

                            const myArray = dulieu[i][5].split("/");
                            var newDate = "";
                            newDate = newDate.concat(myArray[2]);
                            newDate = newDate.concat("-");
                            newDate = newDate.concat(myArray[1]);
                            newDate = newDate.concat("-");
                            newDate = newDate.concat(myArray[0]);


                            obj["ngayQuyetdinhCapphep"] = newDate;
                        }

                        if (dulieu[i][6] !== '' && dulieu[i][6] !== null)
                            obj["vontuongduongUsd"] = dulieu[i][6];
                        if (dulieu[i][7] !== '' && dulieu[i][7] !== null)
                            obj["quymoCongsuat"] = dulieu[i][7];
                        if (dulieu[i][8] !== '' && dulieu[i][8] !== null) {
                            const myArray = dulieu[i][8].split("/");
                            var newDate = "";
                            newDate = newDate.concat(myArray[2]);
                            newDate = newDate.concat("-");
                            newDate = newDate.concat(myArray[1]);
                            newDate = newDate.concat("-");
                            newDate = newDate.concat(myArray[0]);

                            obj["ngayHetphepHoatdong"] = newDate;
                        }


                        if (dulieu[i][9] !== '' && dulieu[i][9] !== null) {
                            for (var j = 0; j < str_loaihinhduans.length; j++) {
                                if (str_loaihinhduans[j] === dulieu[i][9]) {
                                    obj["idLoaihinhDuan"] = id_loaihinhduans[j];
                                    break;
                                }
                            }
                        }


                        if (dulieu[i][10] !== '' && dulieu[i][10] !== null) {
                            for (var j = 0; j < str_doanhnghieps.length; j++) {
                                if (str_doanhnghieps[j] === dulieu[i][10]) {
                                    obj["idDoanhnghiep"] = id_doanhnghieps[j];
                                    break;
                                }
                            }
                        }

                        if (dulieu[i][11] !== '' && dulieu[i][11] !== null) {
                            for (var j = 0; j < str_nguonvondautus.length; j++) {
                                if (str_nguonvondautus[j] === dulieu[i][11]) {
                                    obj["idNguonvon"] = id_nguonvondautus[j];
                                    break;
                                }
                            }
                        }

                        if (dulieu[i][12] !== '' && dulieu[i][12] !== null) {
                            for (var j = 0; j < str_khuchuyennganhs.length; j++) {
                                if (str_khuchuyennganhs[j] === dulieu[i][12]) {
                                    obj["idKhuChuyennganh"] = id_khuchuyennganhs[j];
                                    break;
                                }
                            }
                        }



                        //                        str_doanhnghieps, , ,str_dmlinhvucsanxuatkinhdoanhs, str_dmtrangthais,
                        if (dulieu[i][13] !== '' && dulieu[i][13] !== null) {
                            for (var j = 0; j < str_dmtrangthais.length; j++) {
                                if (str_dmtrangthais[j] === dulieu[i][13]) {
                                    //console.log(id_dmtrangthais[j])
                                    obj["idTrangthaiDuan"] = id_dmtrangthais[j];
                                    break;
                                }
                            }
                        }

                        if (dulieu[i][14] !== '' && dulieu[i][14] !== null)
                            obj["tongmucDautu"] = dulieu[i][14];



                        //console.log(obj)
                        // Biến cờ hiệu
                        var flag = true;
                        if (dulieu[i][1] === '' || dulieu[i][1] === null) {
                            alert('Dòng ' + (i + 1) + ' chưa nhập tên dự án');
                            flag = false;
                        }


                        if (dulieu[i][2] === '' || dulieu[i][2] === null) {
                            alert('Dòng ' + (i + 1) + ' chưa nhập số quyết định cho phép');
                            flag = false;
                        }

                        if (dulieu[i][3] === '' || dulieu[i][3] === null) {
                            alert('Dòng ' + (i + 1) + ' chưa nhập vốn đăng ký đầu tư');
                            flag = false;
                        }



                        if (dulieu[i][4] === '' || dulieu[i][4] === null) {
                            alert('Dòng ' + (i + 1) + ' chưa nhập mã số dự án');

                            flag = false;
                        }

                        //                        if (dulieu[i][5] === '' || dulieu[i][5] === null) {
                        //                            alert('Dòng ' + (i + 1) + ' chưa nhập ngày quyết định cấp phép');
                        //                            
                        //                            flag = false;
                        //                        }



                        if (dulieu[i][6] === '' || dulieu[i][6] === null) {
                            alert('Dòng ' + (i + 1) + ' chưa nhập vốn tương đương USD');

                            flag = false;
                        }

                        if (dulieu[i][7] === '' || dulieu[i][7] === null) {
                            alert('Dòng ' + (i + 1) + ' chưa nhập quy mô công suất');

                            flag = false;
                        }




                        //                        if (dulieu[i][8] === '' || dulieu[i][8] === null) {
                        //                            alert('Dòng ' + (i + 1) + ' chưa nhập ngày hết phép hoạt động');
                        //                            flag = false;
                        //                        }

                        if (dulieu[i][9] === '' || dulieu[i][9] === null) {
                            alert('Dòng ' + (i + 1) + ' chưa nhập loại hình dự án');
                            flag = false;
                        }

                        if (dulieu[i][10] === '' || dulieu[i][10] === null) {
                            alert('Dòng ' + (i + 1) + ' chưa nhập doanh nghiệp');
                            flag = false;
                        }
                        if (dulieu[i][11] === '' || dulieu[i][11] === null) {
                            alert('Dòng ' + (i + 1) + ' chưa nhập nguồn vốn');
                            flag = false;
                        }

                        if (dulieu[i][12] === '' || dulieu[i][12] === null) {
                            alert('Dòng ' + (i + 1) + ' chưa nhập khu chuyên ngành');

                            flag = false;
                        }


                        if (dulieu[i][13] === '' || dulieu[i][13] === null) {

                            alert('Dòng ' + (i + 1) + ' chưa nhập trạng thái dự án');
                            flag = false;
                        }

                        if (dulieu[i][14] === '' || dulieu[i][14] === null) {
                            alert('Dòng ' + (i + 1) + ' chưa nhập tổng mức đầu tư');
                            flag = false;
                        }

                        if (flag === true) {
                            changed = 1;
                            jQuery.ajax({
                                headers: {
                                    'Accept': 'application/json',
                                    'Content-Type': 'application/json'
                                },
                                'type': 'POST',
                                //chu y
                                'async': false,
                                'url': "http://" + hostname + ":" + port + "/duanXaydunghatang/duanXaydunghatang/",
                                'data': JSON.stringify(obj),
                                'dataType': 'json',
                            }).done(function (data) {
                                var jsonData = JSON.parse(JSON.stringify(data));
                                console.log(jsonData)
                                var res = {};
                                res.id = jsonData.id;


                                if (jsonData.ten === null)
                                    res.ten = "";//ten doanh nghiep
                                else
                                    res.ten = jsonData.ten;
                                if (jsonData.soqdCapphep === null)
                                    res.soqdCapphep = "";
                                else
                                    res.soqdCapphep = jsonData.soqdCapphep;



                                if (jsonData.vondautuDangky === null)
                                    res.vondautuDangky = "";//dia chi                    
                                else
                                    res.vondautuDangky = jsonData.vondautuDangky;

                                if (jsonData.tongmucDautu === null)
                                    res.tongmucDautu = "";//dia chi                    
                                else
                                    res.tongmucDautu = jsonData.tongmucDautu;



                                if (jsonData.masoDuan === null)
                                    res.masoDuan = "";//ma dang ky                    
                                else
                                    res.masoDuan = jsonData.masoDuan;

                                if (jsonData.ngayQuyetdinhCapphep === null)
                                    res.ngayQuyetdinhCapphep = "";//ngay dang ky  
                                else {

                                    res.ngayQuyetdinhCapphep = jsonData.ngayQuyetdinhCapphep;
                                    console.log(res.ngayQuyetdinhCapphep)
                                    const dateFormat = res.ngayQuyetdinhCapphep.split("T");
                                    res.ngayQuyetdinhCapphep = dateFormat[0];
                                    const myArray = res.ngayQuyetdinhCapphep.split("-");
                                    var newDate = "";
                                    newDate = newDate.concat(myArray[2]);
                                    newDate = newDate.concat("/");
                                    newDate = newDate.concat(myArray[1]);
                                    newDate = newDate.concat("/");

                                    newDate = newDate.concat(myArray[0]);


                                    res.ngayQuyetdinhCapphep = newDate;
                                }


                                if (jsonData.vontuongduongUsd === null)
                                    res.vontuongduongUsd = "";//ma so thue    
                                else
                                    res.vontuongduongUsd = jsonData.vontuongduongUsd;

                                if (jsonData.quymoCongsuat === null)
                                    res.quymoCongsuat = "";//linh vuc kinh doanh
                                else
                                    res.quymoCongsuat = jsonData.quymoCongsuat;


                                if (jsonData.ngayHetphepHoatdong === null)
                                    res.ngayHetphepHoatdong = "";//linh vuc kinh doanh
                                else {
                                    res.ngayHetphepHoatdong = jsonData.ngayHetphepHoatdong;
                                    const dateFormat = res.ngayHetphepHoatdong.split("T");
                                    res.ngayHetphepHoatdong = dateFormat[0];
                                    const myArray = res.ngayHetphepHoatdong.split("-");
                                    var newDate = "";
                                    newDate = newDate.concat(myArray[2]);
                                    newDate = newDate.concat("/");
                                    newDate = newDate.concat(myArray[1]);
                                    newDate = newDate.concat("/");

                                    newDate = newDate.concat(myArray[0]);


                                    res.ngayHetphepHoatdong = newDate;
                                }


                                if (jsonData.idLoaihinhDuan === null)
                                    res.idLoaihinhDuan = "";//linh vuc kinh doanh
                                else
                                    res.idLoaihinhDuan = jsonData.idLoaihinhDuan.loaihinhDuan;

                                if (jsonData.idKhuChuyennganh === null)
                                    res.khuchuyennganh = "";
                                else
                                    res.khuchuyennganh = jsonData.idKhuChuyennganh.ten;


                                if (jsonData.idDoanhnghiep === null)
                                    res.tenDoanhnghiep = "";
                                else
                                    res.tenDoanhnghiep = jsonData.idDoanhnghiep.ten;


                                if (jsonData.idNguonvon === null)
                                    res.nguonvon = "";
                                else
                                    res.nguonvon = jsonData.idNguonvon.nguonvon;




                                if (jsonData.idTrangthaiDuan === null)
                                    res.trangthai = "";
                                else
                                    res.trangthai = jsonData.idTrangthaiDuan.trangthai;

                                console.log(" i   =" + i)
                                var changes = [
                                    [i, 'id', res.id],
                                    [i, 'ten', res.ten],
                                    [i, 'soqdCapphep', res.soqdCapphep],
                                    [i, 'vondautuDangky', res.vondautuDangky],
                                    [i, 'masoDuan', res.masoDuan],
                                    [i, 'ngayQuyetdinhCapphep', res.ngayQuyetdinhCapphep],
                                    [i, 'vontuongduongUsd', res.vontuongduongUsd],
                                    [i, 'quymoCongsuat', res.quymoCongsuat],
                                    [i, 'ngayHetphepHoatdong', res.ngayHetphepHoatdong],
                                    [i, 'idLoaihinhDuan', res.idLoaihinhDuan],
                                    [i, 'khuchuyennganh', res.khuchuyennganh],
                                    [i, 'tenDoanhnghiep', res.tenDoanhnghiep],
                                    [i, 'nguonvon', res.nguonvon],
                                    [i, 'trangthai', res.trangthai],
                                    [i, 'tongmucDautu', res.tongmucDautu],
                                ];
                                hotdaxdht.setDataAtRowProp(changes);

                                var postxaydunghatang = '';

                                postxaydunghatang += '<div class="element_DAXDHT__row" id="element_DAXDHT__row__' + jsonData.id + '">';
                                //1
                                postxaydunghatang += `<div class="row">`;
                                postxaydunghatang += `<div class="col-xs-6"><div id='ten' class='tendu${jsonData.id}'>Tên dự án:</div></div>`;
                                if (jsonData.ten === null)
                                    postxaydunghatang += `<div class="col-xs-6"></div>`;
                                else
                                    postxaydunghatang += `<div class="col-xs-6" id='ten' style="text-indent: 0px;">${jsonData.ten}</div>`;
                                postxaydunghatang += `</div>`;


                                //2
                                postxaydunghatang += `<div class="row">`;
                                postxaydunghatang += `<div class="col-xs-6"><div class='dn${jsonData.id}'>Doanh nghiệp:</div></div>`;
                                if (jsonData.idDoanhnghiep === null)
                                    postxaydunghatang += `<div class="col-xs-6"></div>`;
                                else
                                    // postxaydunghatang += `<div class="col-xs-6" style="text-indent: 0px;">${jsonData.idDoanhnghiep.ten}</div>`;

                                    postxaydunghatang += `<div class="col-xs-6" style="text-indent: 0px;">` + $('#DAXDHT-dn option:selected').text() + `</div>`;



                                postxaydunghatang += `</div>`;

                                //3
                                postxaydunghatang += `<div class="row">`;
                                postxaydunghatang += `<div class="col-xs-6"><div class='sqdcp${jsonData.id}'>Số quyết định cho phép:</div></div>`;
                                if (jsonData.soqdCapphep === null)
                                    postxaydunghatang += `<div class="col-xs-6"></div>`;
                                else
                                    postxaydunghatang += `<div class="col-xs-6" style="text-indent: 0px;">${jsonData.soqdCapphep}</div>`;
                                postxaydunghatang += `</div>`;


                                //4
                                postxaydunghatang += `<div class="row">`;
                                postxaydunghatang += `<div class="col-xs-6"><div class='vdtdk${jsonData.id}'>Vốn đầu tư đăng ký:</div></div>`;
                                if (jsonData.vondautuDangky === null)
                                    postxaydunghatang += `<div class="col-xs-6"></div>`;
                                else {
                                    var x = jsonData.vondautuDangky.toLocaleString('it-IT', { style: 'currency', currency: 'VND' });
                                    postxaydunghatang += `<div class="col-xs-6" style="text-indent: 0px;">${x}</div>`;
                                }
                                postxaydunghatang += `</div>`;

                                //5
                                postxaydunghatang += `<div class="row">`;
                                postxaydunghatang += `<div class="col-xs-6"><div class='nv${jsonData.id}'>Nguồn vốn:</div></div>`;
                                if (jsonData.idNguonvon === null)
                                    postxaydunghatang += `<div class="col-xs-6"></div>`;
                                else
                                    // postxaydunghatang += `<div class="col-xs-6" style="text-indent: 0px;">${jsonData.idNguonvon.nguonvon}</div>`;

                                    postxaydunghatang += `<div class="col-xs-6" style="text-indent: 0px;">` + $('#DAXDHT-nv option:selected').text() + `</div>`;



                                postxaydunghatang += `</div>`;

                                //6
                                postxaydunghatang += `<div class="row">`;
                                postxaydunghatang += `<div class="col-xs-6"><div class='kcn${jsonData.id}'>Khu chuyên ngành:</div></div>`;
                                if (jsonData.idKhuChuyennganh === null)
                                    postxaydunghatang += `<div class="col-xs-6"></div>`;
                                else
                                    // postxaydunghatang += `<div class="col-xs-6" style="text-indent: 0px;">${jsonData.idKhuChuyennganh.ten}</div>`;


                                    postxaydunghatang += `<div class="col-xs-6" style="text-indent: 0px;">` + $('#DAXDHT-kcn option:selected').text() + `</div>`;

                                postxaydunghatang += `</div>`;

                                //7
                                postxaydunghatang += `<div class="row">`;
                                postxaydunghatang += `<div class="col-xs-6"><div class='msda${jsonData.id}'>Mã số dự án:</div></div>`;
                                if (jsonData.masoDuan === null)
                                    postxaydunghatang += `<div class="col-xs-6"></div>`;
                                else
                                    postxaydunghatang += `<div class="col-xs-6" style="text-indent: 0px;">${jsonData.masoDuan}</div>`;
                                postxaydunghatang += `</div>`;

                                //8
                                postxaydunghatang += `<div class="row">`;
                                postxaydunghatang += `<div class="col-xs-6"><div class='nqdcp${jsonData.id}'>Ngày quyết định cấp phép:</div></div>`;
                                if (jsonData.ngayQuyetdinhCapphep === null)
                                    postxaydunghatang += `<div class="col-xs-6"></div>`;
                                else {
                                    const dateFormat = jsonData.ngayQuyetdinhCapphep.split("T");
                                    jsonData.ngayQuyetdinhCapphep = dateFormat[0];
                                    postxaydunghatang += `<div class="col-xs-6" style="text-indent: 0px;">${jsonData.ngayQuyetdinhCapphep}</div>`;

                                }
                                postxaydunghatang += `</div>`;


                                //9
                                postxaydunghatang += `<div class="row">`;
                                postxaydunghatang += `<div class="col-xs-6"><div class='vtdusd${jsonData.id}'>Vốn tương đương USD:</div></div>`;
                                if (jsonData.vontuongduongUsd === null)
                                    postxaydunghatang += `<div class="col-xs-6"></div>`;
                                else {
                                    var x = jsonData.vontuongduongUsd.toLocaleString('en-US', { style: 'currency', currency: 'USD' });
                                    postxaydunghatang += `<div class="col-xs-6" style="text-indent: 0px;">${x}</div>`;
                                }
                                postxaydunghatang += `</div>`;


                                //10                            

                                postxaydunghatang += `<div class="row">`;
                                postxaydunghatang += `<div class="col-xs-6"><div class='qmcs${jsonData.id}'>Quy mô/Công suất:</div></div>`;
                                if (jsonData.quymoCongsuat === null)
                                    postxaydunghatang += `<div class="col-xs-6"></div>`;
                                else
                                    postxaydunghatang += `<div class="col-xs-6" style="text-indent: 0px;">${jsonData.quymoCongsuat}</div>`;
                                postxaydunghatang += `</div>`;


                                //11
                                postxaydunghatang += `<div class="row">`;
                                postxaydunghatang += `<div class="col-xs-6"><div class='nhphd${jsonData.id}'>Ngày hết phép hoạt động:</div></div>`;
                                if (jsonData.ngayHetphepHoatdong === null)
                                    postxaydunghatang += `<div class="col-xs-6"></div>`;
                                else {
                                    const dateFormat = jsonData.ngayHetphepHoatdong.split("T");
                                    jsonData.ngayHetphepHoatdong = dateFormat[0];
                                    postxaydunghatang += `<div class="col-xs-6" style="text-indent: 0px;">${jsonData.ngayHetphepHoatdong}</div>`;

                                }
                                postxaydunghatang += `</div>`;

                                //12
                                postxaydunghatang += `<div class="row">`;
                                postxaydunghatang += `<div class="col-xs-6"><div class='ttda${jsonData.id}'>Trạng thái dự án:</div></div>`;
                                if (jsonData.idTrangthaiDuan === null)
                                    postxaydunghatang += `<div class="col-xs-6"></div>`;
                                else
                                    // postxaydunghatang += `<div class="col-xs-6" style="text-indent: 0px;">${jsonData.idTrangthaiDuan.trangthai}</div>`;

                                    postxaydunghatang += `<div class="col-xs-6" style="text-indent: 0px;">` + $('#DAXDHT-ttda option:selected').text() + `</div>`;


                                //13
                                postxaydunghatang += `</div>`;

                                postxaydunghatang += `<div class="row">`;
                                postxaydunghatang += `<div class="col-xs-6"><div class='lhdu${jsonData.id}'>Loại hình dự án:</div></div>`;
                                if (jsonData.idLoaihinhDuan === null)
                                    postxaydunghatang += `<div class="col-xs-6"></div>`;
                                else
                                    // postxaydunghatang += `<div class="col-xs-6" style="text-indent: 0px;">${jsonData.idLoaihinhDuan.loaihinhDuan}</div>`;

                                    postxaydunghatang += `<div class="col-xs-6" style="text-indent: 0px;">` + $('#DAXDHT-lhda option:selected').text() + `</div>`;


                                postxaydunghatang += `</div>`;

                                //14
                                postxaydunghatang += `<div class="row">`;
                                postxaydunghatang += `<div class="col-xs-6"><div class='tmdt${jsonData.id}'>Tổng mức đầu tư:</div></div>`;
                                if (jsonData.tongmucDautu === null)
                                    postxaydunghatang += `<div class="col-xs-6"></div>`;
                                else
                                    postxaydunghatang += `<div class="col-xs-6" style="text-indent: 0px;">${jsonData.tongmucDautu}</div>`;
                                postxaydunghatang += `</div>`;



                                var choice = '<div class="element_DAXDHT__button"><a href="#"><button onclick=editDAXDHT(';
                                choice += jsonData.id;
                                choice += ')><i class="fa fa-edit"></i> Sửa </button></a><a href="#"><button onclick=deleteDAXDHT(';
                                choice += jsonData.id;
                                choice += ')><i class="fa fa-trash"></i> Xóa </button></a><a href="#"><button onclick=chitietDAXDHT(';
                                choice += jsonData.id;
                                choice += ')> Chi tiết </button></a></div>';

                                postxaydunghatang += `<div class="row">`;
                                postxaydunghatang += choice;
                                postxaydunghatang += `</div>`;





                                $.ajax({
                                    url: "http://" + hostname + ":" + port + "/duanXaydunghatang/preduanxaydunghatang/" + jsonData.id,
                                    type: 'GET',
                                    success: function (preId) {
                                        if (preId === -1) {
                                            $(postxaydunghatang).insertAfter("#element_DAXDHT__row__0");
                                        } else {
                                            $(postxaydunghatang).insertAfter("#element_DAXDHT__row__" + preId);
                                        }
                                    }
                                })




                            }).fail(function (jqXHR, textStatus, errorThrown) {
                                checkAdd = 0;
                            });
                        }
                        else {
                            checkAdd = 0;
                        }
                    }
                }
                //bước 3. sửa dữ liệu
                //console.log('changes:' + arrID_Change.toString());
                for (i = 0; i < arrRow_Change.length; i++) {
                    var obj = {};

                    if (dulieu[arrRow_Change[i]][1] !== '' && dulieu[arrRow_Change[i]][1] !== null)
                        obj["ten"] = dulieu[arrRow_Change[i]][1];

                    if (dulieu[arrRow_Change[i]][2] !== '' && dulieu[arrRow_Change[i]][2] !== null)
                        obj["soqdCapphep"] = dulieu[arrRow_Change[i]][2];
                    if (dulieu[arrRow_Change[i]][3] !== '' && dulieu[arrRow_Change[i]][3] !== null)
                        obj["vondautuDangky"] = dulieu[arrRow_Change[i]][3];

                    if (dulieu[arrRow_Change[i]][4] !== '' && dulieu[arrRow_Change[i]][4] !== null)
                        obj["masoDuan"] = dulieu[arrRow_Change[i]][4];
                    if (dulieu[arrRow_Change[i]][5] !== '' && dulieu[arrRow_Change[i]][5] !== null) {
                        const myArray = dulieu[arrRow_Change[i]][5].split("/");
                        var newDate = "";
                        newDate = newDate.concat(myArray[2]);
                        newDate = newDate.concat("-");
                        newDate = newDate.concat(myArray[1]);
                        newDate = newDate.concat("-");
                        newDate = newDate.concat(myArray[0]);
                        console.log("ngayquyetdinhcapphep")
                        console.log(newDate)
                        obj["ngayQuyetdinhCapphep"] = newDate;
                    }

                    if (dulieu[arrRow_Change[i]][14] !== '' && dulieu[arrRow_Change[i]][14] !== null)
                        obj["tongmucDautu"] = dulieu[arrRow_Change[i]][14];

                    if (dulieu[arrRow_Change[i]][6] !== '' && dulieu[arrRow_Change[i]][6] !== null)
                        obj["vontuongduongUsd"] = dulieu[arrRow_Change[i]][6];
                    if (dulieu[arrRow_Change[i]][7] !== '' && dulieu[arrRow_Change[i]][7] !== null)
                        obj["quymoCongsuat"] = dulieu[arrRow_Change[i]][7];
                    if (dulieu[arrRow_Change[i]][8] !== '' && dulieu[arrRow_Change[i]][8] !== null) {
                        const myArray = dulieu[arrRow_Change[i]][8].split("/");
                        console.log(myArray)
                        var newDate = "";
                        newDate = newDate.concat(myArray[2]);
                        newDate = newDate.concat("-");
                        newDate = newDate.concat(myArray[1]);
                        newDate = newDate.concat("-");
                        newDate = newDate.concat(myArray[0]);
                        console.log("ngayhetphephoatdong")

                        console.log(newDate)
                        obj["ngayHetphepHoatdong"] = newDate;
                    }


                    if (dulieu[arrRow_Change[i]][9] !== '' && dulieu[arrRow_Change[i]][9] !== null) {
                        for (var j = 0; j < str_loaihinhduans.length; j++) {
                            if (str_loaihinhduans[j] === dulieu[arrRow_Change[i]][9]) {
                                obj["idLoaihinhDuan"] = id_loaihinhduans[j];
                                break;
                            }
                        }
                    }


                    if (dulieu[arrRow_Change[i]][10] !== '' && dulieu[arrRow_Change[i]][10] !== null) {
                        for (var j = 0; j < str_doanhnghieps.length; j++) {
                            if (str_doanhnghieps[j] === dulieu[arrRow_Change[i]][10]) {
                                obj["idDoanhnghiep"] = id_doanhnghieps[j];
                                break;
                            }
                        }
                    }

                    if (dulieu[arrRow_Change[i]][11] !== '' && dulieu[arrRow_Change[i]][11] !== null) {
                        for (var j = 0; j < str_nguonvondautus.length; j++) {
                            if (str_nguonvondautus[j] === dulieu[arrRow_Change[i]][11]) {
                                obj["idNguonvon"] = id_nguonvondautus[j];
                                break;
                            }
                        }
                    }

                    if (dulieu[arrRow_Change[i]][12] !== '' && dulieu[arrRow_Change[i]][12] !== null) {
                        for (var j = 0; j < str_khuchuyennganhs.length; j++) {
                            if (str_khuchuyennganhs[j] === dulieu[arrRow_Change[i]][12]) {
                                obj["idKhuChuyennganh"] = id_khuchuyennganhs[j];
                                break;
                            }
                        }
                    }



                    //                        str_doanhnghieps, , ,str_dmlinhvucsanxuatkinhdoanhs, str_dmtrangthais,
                    if (dulieu[arrRow_Change[i]][13] !== '' && dulieu[arrRow_Change[i]][13] !== null) {
                        for (var j = 0; j < str_dmtrangthais.length; j++) {
                            if (str_dmtrangthais[j] === dulieu[arrRow_Change[i]][13]) {
                                obj["idTrangthaiDuan"] = id_dmtrangthais[j];
                                break;
                            }
                        }
                    }
                    // Biến cờ hiệu
                    var flag = true;
                    console.log("??/")
                    console.log(obj)

                    if (dulieu[arrRow_Change[i]][1] === '' || dulieu[arrRow_Change[i]][1] === null) {
                        alert('Dòng ' + (arrRow_Change[i] + 1) + ' chưa nhập tên dự án');
                        flag = false;
                    }


                    if (dulieu[arrRow_Change[i]][2] === '' || dulieu[arrRow_Change[i]][2] === null) {
                        alert('Dòng ' + (arrRow_Change[i] + 1) + ' chưa nhập số quyết định cho phép');
                        flag = false;
                    }

                    if (dulieu[arrRow_Change[i]][3] === '' || dulieu[arrRow_Change[i]][3] === null) {
                        alert('Dòng ' + (arrRow_Change[i] + 1) + ' chưa nhập vốn đăng ký đầu tư');
                        flag = false;
                    }



                    if (dulieu[arrRow_Change[i]][4] === '' || dulieu[arrRow_Change[i]][4] === null) {
                        alert('Dòng ' + (arrRow_Change[i] + 1) + ' chưa nhập mã số dự án');

                        flag = false;
                    }

                    //                        if (dulieu[arrRow_Change[i]][5] === '' || dulieu[arrRow_Change[i]][5] === null) {
                    //                            alert('Dòng ' + (arrRow_Change[i] + 1) + ' chưa nhập ngày quyết định cấp phép');
                    //                            
                    //                            flag = false;
                    //                        }



                    if (dulieu[arrRow_Change[i]][6] === '' || dulieu[arrRow_Change[i]][6] === null) {
                        alert('Dòng ' + (arrRow_Change[i] + 1) + ' chưa nhập vốn tương đương USD');

                        flag = false;
                    }

                    if (dulieu[arrRow_Change[i]][7] === '' || dulieu[arrRow_Change[i]][7] === null) {
                        alert('Dòng ' + (arrRow_Change[i] + 1) + ' chưa nhập quy mô công suất');

                        flag = false;
                    }




                    //                        if (dulieu[arrRow_Change[i]][8] === '' || dulieu[arrRow_Change[i]][8] === null) {
                    //                            alert('Dòng ' + (arrRow_Change[i] + 1) + ' chưa nhập ngày hết phép hoạt động');
                    //                            flag = false;
                    //                        }

                    if (dulieu[arrRow_Change[i]][9] === '' || dulieu[arrRow_Change[i]][9] === null) {
                        alert('Dòng ' + (arrRow_Change[i] + 1) + ' chưa nhập loại hình dự án');
                        flag = false;
                    }

                    if (dulieu[arrRow_Change[i]][10] === '' || dulieu[arrRow_Change[i]][10] === null) {
                        alert('Dòng ' + (arrRow_Change[i] + 1) + ' chưa nhập doanh nghiệp');
                        flag = false;
                    }
                    if (dulieu[arrRow_Change[i]][11] === '' || dulieu[arrRow_Change[i]][11] === null) {
                        alert('Dòng ' + (arrRow_Change[i] + 1) + ' chưa nhập nguồn vốn');
                        flag = false;
                    }

                    if (dulieu[arrRow_Change[i]][12] === '' || dulieu[arrRow_Change[i]][12] === null) {
                        alert('Dòng ' + (arrRow_Change[i] + 1) + ' chưa nhập khu chuyên ngành');

                        flag = false;
                    }


                    if (dulieu[arrRow_Change[i]][13] === '' || dulieu[arrRow_Change[i]][13] === null) {

                        alert('Dòng ' + (arrRow_Change[i] + 1) + ' chưa nhập trạng thái dự án');
                        flag = false;
                    }

                    if (dulieu[arrRow_Change[i]][14] === '' || dulieu[arrRow_Change[i]][14] === null) {
                        alert('Dòng ' + (arrRow_Change[i] + 1) + ' chưa nhập tổng mức đầu tư');
                        flag = false;
                    }



                    if (flag === true) {
                        changed = 1;
                        jQuery.ajax({
                            headers: {
                                'Accept': 'application/json',
                                'Content-Type': 'application/json'
                            },
                            'type': 'PUT',
                            'url': "http://" + hostname + ":" + port + "/duanXaydunghatang/duanXaydunghatang/" + arrID_Change[i],
                            'data': JSON.stringify(obj),
                            'dataType': 'json'
                        }).done(function (data) {



                            $.ajax({
                                // lấy thẻ cũ
                                url: "http://" + hostname + ":" + port + "/duanXaydunghatang/duanXaydunghatang/" + data.id,
                                type: 'GET',
                                success: function (response) {

                                    console.log(response)



                                    var duanxaydunghatang_changed = document.getElementById("element_DAXDHT__row__" + response.id);

                                    duanxaydunghatang_changed.innerHTML = "";

                                    duanxaydunghatang_changed.innerHTML += `<div class="row">`;
                                    duanxaydunghatang_changed.innerHTML += `<div class="col-xs-6"><div id='ten' class='tendu${response.id}'>Tên dự án:</div></div>`;
                                    if (response.ten === null)
                                        duanxaydunghatang_changed.innerHTML += `<div class="col-xs-6"></div>`;
                                    else
                                        duanxaydunghatang_changed.innerHTML += `<div class="col-xs-6" id='ten' style="text-indent: 0px;">${response.ten}</div>`;
                                    duanxaydunghatang_changed.innerHTML += `</div>`;

                                    duanxaydunghatang_changed.innerHTML += `<div class="row">`;
                                    duanxaydunghatang_changed.innerHTML += `<div class="col-xs-6"><div class='dn${response.id}'>Doanh nghiệp:</div></div>`;
                                    if (response.idDoanhnghiep === null)
                                        duanxaydunghatang_changed.innerHTML += `<div class="col-xs-6"></div>`;
                                    else
                                        duanxaydunghatang_changed.innerHTML += `<div class="col-xs-6" style="text-indent: 0px;">${response.idDoanhnghiep.ten}</div>`;
                                    duanxaydunghatang_changed.innerHTML += `</div>`;

                                    duanxaydunghatang_changed.innerHTML += `<div class="row">`;
                                    duanxaydunghatang_changed.innerHTML += `<div class="col-xs-6"><div class='sqdcp${response.id}'>Số quyết định cho phép:</div></div>`;
                                    if (response.soqdCapphep === null)
                                        duanxaydunghatang_changed.innerHTML += `<div class="col-xs-6"></div>`;
                                    else
                                        duanxaydunghatang_changed.innerHTML += `<div class="col-xs-6" style="text-indent: 0px;">${response.soqdCapphep}</div>`;
                                    duanxaydunghatang_changed.innerHTML += `</div>`;

                                    duanxaydunghatang_changed.innerHTML += `<div class="row">`;
                                    duanxaydunghatang_changed.innerHTML += `<div class="col-xs-6"><div class='vdtdk${response.id}'>Vốn đầu tư đăng ký:</div></div>`;
                                    if (response.vondautuDangky === null)
                                        duanxaydunghatang_changed.innerHTML += `<div class="col-xs-6"></div>`;
                                    else {
                                        var x = response.vondautuDangky.toLocaleString('it-IT', { style: 'currency', currency: 'VND' });
                                        duanxaydunghatang_changed.innerHTML += `<div class="col-xs-6" style="text-indent: 0px;">${x}</div>`;
                                    }
                                    duanxaydunghatang_changed.innerHTML += `</div>`;

                                    duanxaydunghatang_changed.innerHTML += `<div class="row">`;
                                    duanxaydunghatang_changed.innerHTML += `<div class="col-xs-6"><div class='nv${response.id}'>Nguồn vốn:</div></div>`;
                                    if (response.idNguonvon === null)
                                        duanxaydunghatang_changed.innerHTML += `<div class="col-xs-6"></div>`;
                                    else
                                        duanxaydunghatang_changed.innerHTML += `<div class="col-xs-6" style="text-indent: 0px;">${response.idNguonvon.nguonvon}</div>`;
                                    duanxaydunghatang_changed.innerHTML += `</div>`;

                                    duanxaydunghatang_changed.innerHTML += `<div class="row">`;
                                    duanxaydunghatang_changed.innerHTML += `<div class="col-xs-6"><div class='kcn${response.id}'>Khu chuyên ngành:</div></div>`;
                                    if (response.idKhuChuyennganh === null)
                                        duanxaydunghatang_changed.innerHTML += `<div class="col-xs-6"></div>`;
                                    else
                                        duanxaydunghatang_changed.innerHTML += `<div class="col-xs-6" style="text-indent: 0px;">${response.idKhuChuyennganh.ten}</div>`;
                                    duanxaydunghatang_changed.innerHTML += `</div>`;

                                    duanxaydunghatang_changed.innerHTML += `<div class="row">`;
                                    duanxaydunghatang_changed.innerHTML += `<div class="col-xs-6"><div class='msda${response.id}'>Mã số dự án:</div></div>`;
                                    if (response.masoDuan === null)
                                        duanxaydunghatang_changed.innerHTML += `<div class="col-xs-6"></div>`;
                                    else
                                        duanxaydunghatang_changed.innerHTML += `<div class="col-xs-6" style="text-indent: 0px;">${response.masoDuan}</div>`;
                                    duanxaydunghatang_changed.innerHTML += `</div>`;

                                    duanxaydunghatang_changed.innerHTML += `<div class="row">`;
                                    duanxaydunghatang_changed.innerHTML += `<div class="col-xs-6"><div class='nqdcp${response.id}'>Ngày quyết định cấp phép:</div></div>`;
                                    if (response.ngayQuyetdinhCapphep === null)
                                        duanxaydunghatang_changed.innerHTML += `<div class="col-xs-6"></div>`;
                                    else
                                        duanxaydunghatang_changed.innerHTML += `<div class="col-xs-6" style="text-indent: 0px;">${response.ngayQuyetdinhCapphep}</div>`;
                                    duanxaydunghatang_changed.innerHTML += `</div>`;

                                    duanxaydunghatang_changed.innerHTML += `<div class="row">`;
                                    duanxaydunghatang_changed.innerHTML += `<div class="col-xs-6"><div class='vtdusd${response.id}'>Vốn tương đương USD:</div></div>`;
                                    if (response.vontuongduongUsd === null)
                                        duanxaydunghatang_changed.innerHTML += `<div class="col-xs-6"></div>`;
                                    else {
                                        var x = response.vontuongduongUsd.toLocaleString('en-US', { style: 'currency', currency: 'USD' });
                                        duanxaydunghatang_changed.innerHTML += `<div class="col-xs-6" style="text-indent: 0px;">${x}</div>`;
                                    }
                                    duanxaydunghatang_changed.innerHTML += `</div>`;

                                    duanxaydunghatang_changed.innerHTML += `<div class="row">`;
                                    duanxaydunghatang_changed.innerHTML += `<div class="col-xs-6"><div class='qmcs${response.id}'>Quy mô/Công suất:</div></div>`;
                                    if (response.quymoCongsuat === null)
                                        duanxaydunghatang_changed.innerHTML += `<div class="col-xs-6"></div>`;
                                    else
                                        duanxaydunghatang_changed.innerHTML += `<div class="col-xs-6" style="text-indent: 0px;">${response.quymoCongsuat}</div>`;
                                    duanxaydunghatang_changed.innerHTML += `</div>`;

                                    duanxaydunghatang_changed.innerHTML += `<div class="row">`;
                                    duanxaydunghatang_changed.innerHTML += `<div class="col-xs-6"><div class='nhphd${response.id}'>Ngày hết phép hoạt động:</div></div>`;
                                    if (response.ngayHetphepHoatdong === null)
                                        duanxaydunghatang_changed.innerHTML += `<div class="col-xs-6"></div>`;
                                    else
                                        duanxaydunghatang_changed.innerHTML += `<div class="col-xs-6" style="text-indent: 0px;">${response.ngayHetphepHoatdong}</div>`;
                                    duanxaydunghatang_changed.innerHTML += `</div>`;

                                    duanxaydunghatang_changed.innerHTML += `<div class="row">`;
                                    duanxaydunghatang_changed.innerHTML += `<div class="col-xs-6"><div class='ttda${response.id}'>Trạng thái dự án:</div></div>`;
                                    if (response.idTrangthaiDuan === null)
                                        duanxaydunghatang_changed.innerHTML += `<div class="col-xs-6"></div>`;
                                    else
                                        duanxaydunghatang_changed.innerHTML += `<div class="col-xs-6" style="text-indent: 0px;">${response.idTrangthaiDuan.trangthai}</div>`;
                                    duanxaydunghatang_changed.innerHTML += `</div>`;

                                    duanxaydunghatang_changed.innerHTML += `<div class="row">`;
                                    duanxaydunghatang_changed.innerHTML += `<div class="col-xs-6"><div class='lhdu${response.id}'>Loại hình dự án:</div></div>`;
                                    if (response.idLoaihinhDuan === null)
                                        duanxaydunghatang_changed.innerHTML += `<div class="col-xs-6"></div>`;
                                    else
                                        duanxaydunghatang_changed.innerHTML += `<div class="col-xs-6" style="text-indent: 0px;">${response.idLoaihinhDuan.loaihinhDuan}</div>`;
                                    duanxaydunghatang_changed.innerHTML += `</div>`;

                                    duanxaydunghatang_changed.innerHTML += `<div class="row">`;
                                    duanxaydunghatang_changed.innerHTML += `<div class="col-xs-6"><div class='tmdt${response.id}'>Tổng mức đầu tư:</div></div>`;
                                    if (response.tongmucDautu === null)
                                        duanxaydunghatang_changed.innerHTML += `<div class="col-xs-6"></div>`;
                                    else
                                        duanxaydunghatang_changed.innerHTML += `<div class="col-xs-6" style="text-indent: 0px;">${response.tongmucDautu}</div>`;
                                    duanxaydunghatang_changed.innerHTML += `</div>`;





                                    var choice = '<div class="element_DAXDHT__button"><a href="#"><button onclick=editDAXDHT(';
                                    choice += response.id;
                                    choice += ')><i class="fa fa-edit"></i> Sửa </button></a><a href="#"><button onclick=deleteDAXDHT(';
                                    choice += response.id;
                                    choice += ')><i class="fa fa-trash"></i> Xóa </button></a><a href="#"><button onclick=chitietDAXDHT(';
                                    choice += response.id;
                                    choice += ')> Chi tiết </button></a></div>';

                                    duanxaydunghatang_changed.innerHTML += `<div class="row">`;
                                    duanxaydunghatang_changed.innerHTML += choice;
                                    duanxaydunghatang_changed.innerHTML += `</div>`;



                                }
                            })



                        }).fail(function (jqXHR, textStatus, errorThrown) {
                            checkUpdate = 0;
                        });
                    } else {
                        checkUpdate = 0;
                    }
                }
                arrID_Change = [];
                arrRow_Change = [];

                if (changed === 1 && checkAdd === 1 && checkDelete === 1 && checkUpdate === 1) {
                
                $("#duanxaydunghatang-success-alert").fadeTo(2000, 500).slideUp(500, function () {
                    $("#duanxaydunghatang-success-alert").slideUp(500);
                });
            }



            });
            $(document).ready(function () {
                changeinnerWidth_duanxaydunghatang = function () {
                    $('#mapView').css("width", "70%");
                    $('#content').css("width", "30%");
                    loadHtml('window_duanxaydunghatang_mini', 'duanxaydunghatang-mini.html');
                }
            });

            $('.doanhnghiep_closegrid').click(function () {
                event.preventDefault();
                $('.doanhnghiep_closegrid').addClass('active');
                if ($('.doanhnghiep_closegrid').hasClass("active")) {

                    $(".mob-min").css("width", "0%");
                    $(".mob-max").css("width", "100%");
                    $(".doanhnghiep_open").css("display", "flex");



                } else {

                    $(".doanhnghiep_open").css("display", "none");

                }
            });


            function loadGridxaydunghatang() {
                data_duanxaydunghatang = [];
                try {
                    dynamicSQL('http://' + hostname + ':' + port + '/duanXaydunghatang/duanXaydunghatangs/');
                    Object.keys(dataResponse).forEach(function (key) {
                        var element = JSON.parse(JSON.stringify(dataResponse[key]));

                        var res = {};

                        res.id = element.id;

                        if (element.ten === null)
                            res.ten = "";//ten doanh nghiep
                        else
                            res.ten = element.ten;

                        if (element.soqdCapphep === null)
                            res.soqdCapphep = "";//giam doc
                        else
                            res.soqdCapphep = element.soqdCapphep;

                        if (element.vondautuDangky === null)
                            res.vondautuDangky = "";//dia chi                    
                        else
                            res.vondautuDangky = element.vondautuDangky;

                        if (element.tongmucDautu === null)
                            res.tongmucDautu = "";//dia chi                    
                        else
                            res.tongmucDautu = element.tongmucDautu;





                        if (element.masoDuan === null)
                            res.masoDuan = "";//ma dang ky                    
                        else
                            res.masoDuan = element.masoDuan;

                        if (element.ngayQuyetdinhCapphep === null)
                            res.ngayQuyetdinhCapphep = "";//ngay dang ky  
                        else {

                            const myArray = element.ngayQuyetdinhCapphep.split("-");
                            var newDate = "";
                            newDate = newDate.concat(myArray[2]);
                            newDate = newDate.concat("/");
                            newDate = newDate.concat(myArray[1]);
                            newDate = newDate.concat("/");

                            newDate = newDate.concat(myArray[0]);


                            res.ngayQuyetdinhCapphep = newDate;
                        }


                        if (element.vontuongduongUsd === null)
                            res.vontuongduongUsd = "";//ma so thue    
                        else
                            res.vontuongduongUsd = element.vontuongduongUsd;

                        if (element.quymoCongsuat === null)
                            res.quymoCongsuat = "";//linh vuc kinh doanh
                        else
                            res.quymoCongsuat = element.quymoCongsuat;


                        if (element.ngayHetphepHoatdong === null)
                            res.ngayHetphepHoatdong = "";//linh vuc kinh doanh
                        else {
                            const myArray = element.ngayHetphepHoatdong.split("-");
                            var newDate = "";
                            newDate = newDate.concat(myArray[2]);
                            newDate = newDate.concat("/");
                            newDate = newDate.concat(myArray[1]);
                            newDate = newDate.concat("/");

                            newDate = newDate.concat(myArray[0]);


                            res.ngayHetphepHoatdong = newDate;
                        }


                        if (element.idLoaihinhDuan === null)
                            res.idLoaihinhDuan = "";//linh vuc kinh doanh
                        else
                            res.idLoaihinhDuan = element.idLoaihinhDuan.loaihinhDuan;

                        if (element.idKhuChuyennganh === null)
                            res.khuchuyennganh = "";
                        else
                            res.khuchuyennganh = element.idKhuChuyennganh.ten;


                        if (element.idDoanhnghiep === null)
                            res.tenDoanhnghiep = "";
                        else
                            res.tenDoanhnghiep = element.idDoanhnghiep.ten;


                        if (element.idNguonvon === null)
                            res.nguonvon = "";
                        else
                            res.nguonvon = element.idNguonvon.nguonvon;




                        if (element.idTrangthaiDuan === null)
                            res.trangthai = "";
                        else
                            res.trangthai = element.idTrangthaiDuan.trangthai;



                        data_duanxaydunghatang.push(res);
                    });
                } catch (e) {
                    console.log(e);
                }

                hotdaxdht.updateSettings({
                    data: data_duanxaydunghatang
                });
            }
            ;


        </script>
</body>

</html>